# Lab 21 - Copilot: Investigating Incidents

## Table of Contents
1. [Introduction](#1-introduction)
2. [Implementation](#2-implementation)
   - [Generating Sample Security Alerts](#21-generating-sample-security-alerts)
   - [Viewing Incidents in Microsoft Defender](#22-viewing-incidents-in-microsoft-defender)
   - [Investigating Incidents with Copilot](#23-investigating-incidents-with-copilot)
   - [Generating an Executive Report](#24-generating-an-executive-report)
3. [Impact of Deployment](#3-impact-of-deployment)
4. [Conclusion](#4-conclusion)
5. [References](#5-references)

## 1. Introduction

Microsoft **Security Copilot** enhances **incident investigation and response** by automating data analysis and summarization.  
In this lab, a **sample security incident** is created and investigated using **Microsoft Defender for Cloud** and **Copilot for Security**.

### **Key Features of Copilot Incident Investigation**
- **Automated incident summary generation**.
- **Correlation of attack techniques across multiple endpoints**.
- **Real-time analysis of threat reputation scores**.
- **Executive report generation for non-technical stakeholders**.

> **Screenshot: Sample Alerts in Microsoft Defender**  
> ![Sample Alerts](https://i.imgur.com/m76EhVU.png)

> **Microsoft Documentation:**  
> [Microsoft Copilot for Security Overview](https://www.microsoft.com/de-de/security/business/ai-machine-learning/microsoft-security-copilot)

---

## 2. Implementation

### 2.1 Generating Sample Security Alerts

To create a **test incident**, **Microsoft Defender for Cloud** is used to generate **Sample Alerts**.

#### **Steps to Generate Sample Alerts**
1. Navigate to **Microsoft Defender for Cloud**.
2. Click on **Security Alerts**.
3. Select **"Generate Sample Alerts"**.
4. Choose **"Virtual Machines"** as the target entity.
5. Confirm and wait for alerts to appear in **Microsoft Defender Portal**.

**Outcome**:  
- A **multi-stage attack** was simulated.
- Alerts appeared under **Incidents in Microsoft Defender**.

> **Screenshot: Sample Security Alerts Created**  
> ![Sample Alerts](https://i.imgur.com/m76EhVU.png)

---

### 2.2 Viewing Incidents in Microsoft Defender

After creating the **sample alerts**, the incident can be viewed in **Microsoft Defender Portal**.

#### **Steps to View Incidents**
1. Navigate to **[Microsoft Defender Portal](https://security.microsoft.com)**.
2. Click on **Incidents & Alerts** â†’ **Incidents**.
3. Locate the **Multi-stage incident involving Execution & Defense evasion**.
4. Note the **Incident ID (e.g., 90)**.

> **Screenshot: Sample Incident in Microsoft Defender**  
> ![Incident](https://i.imgur.com/52LJ1cL.png)

**Details of the Incident:**
- Incident **ID: 90**.
- Affects a **sample virtual machine (Sample-VM)**.
- Involves **multiple MITRE ATT&CK tactics** (Execution, Defense Evasion, etc.).

---

### 2.3 Investigating Incidents with Copilot

Microsoft **Security Copilot** assists in **analyzing incidents using predefined prompts**.

#### **Steps to Investigate the Incident with Copilot**
1. Navigate to **[Copilot for Security](https://securitycopilot.microsoft.com/)**.
2. Click on **Prompts**.
3. Select **"Microsoft 365 Defender Incident Investigation"**.
4. Enter the **Incident ID (e.g., 90)**.
5. Click **Submit**.

> **Screenshot: Copilot Investigation Prompt**  
> ![Copilot Investigation](https://i.imgur.com/T5Rqb6y.png)

### **Copilot Analysis Workflow**
The investigation process follows a structured approach:
1. **Summarizes Defender incident details**.
2. **Analyzes entities involved (users, VMs, IPs, files)**.
3. **Checks reputation scores for related IP addresses**.
4. **Validates authentication methods (e.g., MFA enabled or not)**.
5. **Generates an executive report summarizing the incident**.

#### **Example Prompts in the Investigation**
- "What are the reputation scores for the IPv4 addresses in the incident?"
- "Show authentication methods for affected users."
- "Generate an executive summary of the investigation."

---

### 2.4 Generating an Executive Report

At the end of the investigation, Copilot provides an **automated executive report**.

#### **Steps to Generate the Report**
1. Copilot runs all investigation **prompts**.
2. A structured **executive report** is created.
3. The report can be **downloaded as a Word document**.

> **Screenshot: Executive Report Generated by Copilot**  
> ![Executive Report](https://i.imgur.com/Wv9Cbi3.png)

**Sample Conclusion from the Report:**
`This incident involved multiple stages of malicious activity, including ransomware, defense evasion, and digital currency mining, all occurring within a short time frame on the same virtual machine. Immediate attention and remediation are required to address the compromised device and user accounts to prevent further damage.`
---

## 3. Impact of Deployment

### **Security Benefits of Copilot Incident Investigation**
- **Saves time for SOC teams** by automating repetitive investigation tasks.
- **Provides AI-driven insights** into threat actors and attack methodologies.
- **Enhances response efficiency** with structured executive reports.
- **Improves collaboration** by presenting **clear and actionable intelligence**.

> **Example Scenario:**  
> - A **malware attack** is detected in **Microsoft Defender**.  
> - **Security Copilot** generates an **executive summary** for the SOC team.  
> - **Automated remediation** steps are suggested based on the analysis.

---

## 4. Conclusion

This lab demonstrated how to **investigate security incidents using Microsoft Security Copilot**, covering:
- **Generating sample alerts using Defender for Cloud**.
- **Reviewing incident details in Microsoft Defender**.
- **Performing an AI-driven investigation using Copilot**.
- **Generating an executive summary for SOC teams**.

### **Next Steps**
- Enable **automated playbooks** in Sentinel for faster incident remediation.
- Configure **custom Copilot prompts** for threat-hunting workflows.
- Use **Kusto queries** to analyze incident-related logs in-depth.

---

## 5. References

- [Microsoft Copilot for Security Overview](https://www.microsoft.com/de-de/security/business/ai-machine-learning/microsoft-security-copilot)
- [Microsoft Defender for Cloud - Sample Alerts](https://learn.microsoft.com/en-us/azure/security-center/security-alerts)
- [Microsoft Defender Incident Investigation](https://learn.microsoft.com/en-us/microsoft-365/security/defender/investigate-incidents)