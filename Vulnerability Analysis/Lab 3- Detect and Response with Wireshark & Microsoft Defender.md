# Lab 3: Detect and Respond to Sniffing Attacks with Wireshark, Microsoft Defender

## Lab Details

- **Lab Title:** Detect and Respond to Sniffing Attacks using Wireshark and Microsoft Defender  
- **Lab Environment:** EC-Council iLabs, internal network  
- **Resources Used:** Windows Server 2019, Windows 11, Parrot Security  
- **Tools Used:** Cain & Abel, Wireshark, hping3, Microsoft Defender  
- **Target Systems:**  
  - **ARP Poisoning Detection:** Windows 11 (IP: 10.10.1.11) â†” Parrot Security (IP: 10.10.1.13)  


---

## Lab Scenario

This lab demonstrates how to detect a sniffing attack via ARP Poisoning and take appropriate countermeasures to protect the network. Tools such as Cain & Abel and Wireshark are used to identify suspicious activities, followed by implementing firewall rules and static ARP entries as a response.

---

## Task 1: Detect ARP Poisoning in a Switch-Based Network

### Step 1: Configuring Cain & Abel

Cain & Abel was launched on Windows Server 2019 and configured to simulate ARP Poisoning between Windows 11 and Parrot Security.

**Actions:**  
1. Cain & Abel was opened on Windows Server 2019 with administrative privileges.  
2. The sniffer was enabled, and a network scan was performed to identify MAC and IP addresses.  

![img](https://i.imgur.com/1yH5juG.png)
![img](https://i.imgur.com/g2QyNrO.png)

3. ARP Poison Routing was configured:  
   - Target systems: Windows 11 (IP: 10.10.1.11) and Parrot Security (IP: 10.10.1.13).  
   - ARP Poisoning was successfully activated, and the status changed to "Poisoning".  

![img](https://i.imgur.com/6OsR3zF.png)

**Results:**  
- A list of active IP and MAC addresses was collected.  
- ARP Poisoning was successfully executed.  

---

### Step 2: Analyzing Network Traffic with hping3

Parrot Security was used to send targeted ARP packets to Windows 11. These packets were analyzed on Windows Server 2019 using Wireshark.

**Actions:**  
1. hping3 was executed on Parrot Security to send packets to Windows 11:  
   `sudo hping3 -c 100 -2 -p 80 10.10.1.11`  
   - `-c` 100: Sends 100 packets.  
   - `-2`: Uses the UDP protocol.  
   - `-p 80`: Target port is 80.  

![img](https://i.imgur.com/SZsJ9vW.png)

2. Wireshark was launched on Windows Server 2019, and the active network adapter was selected.  
3. A filter was applied to analyze ARP packets.  
4. Results were examined to identify duplicate IP addresses and suspicious ARP responses.
  
![img](https://i.imgur.com/dFiPeVl.png)

**Results:**  
- Duplicate IP addresses (e.g., 10.10.1.11) were identified.  
- Fake ARP packets were detected.  

---

## Task 2: Respond to Sniffing Activities

### Step 1: Configuring Static ARP Entries

A static ARP entry was created on Windows 11 to ensure that IP address 10.10.1.1 (gateway) is always mapped to the correct MAC address.

**Actions:**  
1. PowerShell was opened with administrative privileges. The `Get-NetAdapter` command was used to identify the MAC address (e.g., 02-15-5D20-90-AE).  
2. A static ARP entry was added on Windows 11:  
   `arp -s 10.10.1.1 02-15-5D20-90-ae  
3. The ARP table was verified:  
   `arp -a`
 
![img](https://i.imgur.com/ejBHx3X.png)

**Results:**  
- A static entry was successfully added.  
- Unauthorized MAC addresses were automatically blocked.  

---

### Step 2: Creating a Firewall Rule

A firewall rule was created to block the attacker's IP address (10.10.1.13).

**Actions:**  
1. Windows Defender Firewall was opened, and a new rule was created:  
   - Rule type: Custom.  
   - Program: All programs.  
   - Protocol: TCP/UDP.  
   - Remote IP address: 10.10.1.13.  
   - Action: Block the connection.  
2. The rule was named **Custom Lab** and activated.  

![img](https://i.imgur.com/McdQAhA.png)
![img](https://i.imgur.com/A1L3MuD.png)

**Results:**  
- Network traffic from IP address 10.10.1.13 was blocked.  
- The attacker no longer had access to the target system.  

---

## Summary

### Actions Taken
- Performed ARP Poisoning detection using hping3 and Wireshark.  
- Implemented static ARP entries and firewall rules to respond to detected attacks.  

### Key Learnings
- ARP Poisoning can be successfully detected and mitigated with preventive measures.  
- Static ARP entries and firewall rules provide immediate protection at the host level.  

### Recommendations
- Regularly review ARP tables and network configurations.  
- Utilize Dynamic ARP Inspection and NAC for enhanced security.  