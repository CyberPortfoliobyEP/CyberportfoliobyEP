# Lab: Vulnerability Assessment using OpenVAS in a Docker Environment

## Lab Details

- **Title:** Conducting a Vulnerability Analysis with OpenVAS
- **Target System:** Windows Server 2022 with an enabled and disabled firewall
  - **IP Address:** 10.10.1.22
- **Attacker Machine:** Parrot Security OS
  - **IP Address:** 10.10.1.13
- **Tools:** 
  - Docker
  - OpenVAS/Greenbone Vulnerability Management
  - Firefox Browser

---

## Lab Scenario

This lab involves conducting a vulnerability assessment as part of a penetration test to uncover potential security gaps in a target machine (Windows Server 2022). The target system is scanned twice, first with its firewall enabled and then with the firewall disabled. The objective is to determine how well the existing security measures protect against potential attacks and to identify vulnerabilities that could be exploited.

---

## Steps in Conducting the Vulnerability Assessment

### Step 1: Preparing the Attacker Machine

To begin, I prepared the Parrot Security OS machine by ensuring it was fully updated and equipped with the necessary tools. Using Docker, I downloaded the OpenVAS container image and ran it to provide the scanning environment.

The following commands were used:
- Updating the system: `sudo apt upgrade`
- Pulling the OpenVAS Docker image: `docker pull mikesplain/openvas`
- Running the container: `docker run -d -p 443:443 --name openvas mikesplain/openvas`

After completing this, the container was successfully deployed and ready to use for vulnerability scanning.

![Deployment Screenshot](https://i.imgur.com/LtoyBFW.png)

---

### Step 2: Accessing the OpenVAS Dashboard

Once the OpenVAS container was running, I accessed its dashboard through Firefox. Navigating to `https://127.0.0.1`, I logged in using the default credentials (`admin/admin`), which allowed me to interact with the OpenVAS interface.

Screenshots 2 and 3 document this initial setup.

---

### Step 3: Conducting the First Scan (Firewall Enabled)

With the target system's firewall enabled, I initiated the first vulnerability scan. Using the OpenVAS dashboard, I created a new scan task:
- Task Name: Immediate Scan
- Target IP Address: `10.10.1.22`

The scan was initiated, and results were analyzed after its completion. Key observations from this scan include:
- **Total Vulnerabilities Identified:** 60
- **Key Vulnerability:** DCE/RPC and MSRPC Services Enumeration Reporting
  - **Severity:** Medium (5.0)
  - **Description:** This vulnerability exposes critical information about the target machine's configuration, enabling attackers to plan further exploitation strategies.
- **Additional Vulnerability:** TCP Timestamps
  - **Severity:** Low (2.6)
  - **Description:** This vulnerability could allow timing attacks that help identify the operating system.

The average duration of the scan was approximately 13 minutes and 7 seconds. The detailed results are shown in Screenshot 7.

---

### Step 4: Disabling the Firewall

After analyzing the results of the first scan, I switched to the target machine and disabled its firewall to assess its impact on the vulnerabilities identified. This was done through the following steps:
1. Navigating to the Control Panel on Windows Server 2022.
2. Accessing System and Security > Windows Defender Firewall.
3. Turning off all firewall settings.

Screenshot 8 captures the state of the target machine with its firewall disabled.

---

### Step 5: Conducting the Second Scan (Firewall Disabled)

Returning to the Parrot Security OS machine, I repeated the scan with the same settings. The objective was to compare results and identify any additional vulnerabilities that might surface with the firewall disabled.

Key observations from this scan include:
- **Total Vulnerabilities Identified:** 60 (same as the first scan)
- **Key Vulnerabilities:**
  - DCE/RPC and MSRPC Services Enumeration Reporting
    - **Severity:** Medium (5.0)
  - TCP Timestamps
    - **Severity:** Low (2.6)

These findings confirm that disabling the firewall did not result in the discovery of new vulnerabilities but highlighted the same issues as before. Screenshot 9 documents these results.

---

## Summary

### Actions Taken:
- Prepared the Parrot Security OS machine and deployed the OpenVAS Docker container.
- Accessed the OpenVAS dashboard and conducted two vulnerability scans with the target system's firewall enabled and disabled.

### Key Findings:
- The target system leaks information about its services even with the firewall enabled.
- Vulnerabilities such as DCE/RPC expose critical configuration details, which attackers can exploit for further attacks.
- The TCP Timestamps vulnerability could allow timing attacks, though its severity is relatively low.

### Recommendations:
- Disable or restrict DCE/RPC services on the target system to prevent information leakage.
- Implement timestamp masking to obscure TCP timestamps.
- Review and harden firewall rules to minimize information exposure about open ports.